{% load static %}
<!DOCTYPE html>
<html>

  <head>
    <title>Service Request</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"> -->
    <!-- <link href="service-request.css" rel="stylesheet"> -->

    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script> -->

    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"> -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.7/dist/umd/popper.min.js"></script> -->
    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script> -->

    <style>
      #user-table td {
        font-size: 12px;
      }

      .dataTables_filter {
        padding: 10px;
      }
    </style>
    <style>
  .modal {
    display: none; /* Hidden by default */
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.5); /* Black background with opacity */
  }

  .modal-content-customized {
    background-color: #cecece;
    margin: 10% auto;
    padding: 5px;
    border-radius: 10px;
    width: 40%;
  }

  .close {
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }
  .styled-form {
    max-width: 400px;
    margin: 10px auto;
    padding: 15px;
    background-color: #ffffff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    font-family: Arial, sans-serif;
  }

  .styled-form label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
    color: #333;
  }

  .styled-form input[type="text"] {
    width: 100%;
    padding: 10px 12px;
    margin-bottom: 20px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 14px;
    transition: border-color 0.3s ease;
  }

  .styled-form input[type="text"]:focus {
    border-color: #4a90e2;
    outline: none;
  }

  .styled-form button {
    width: 100%;
    padding: 10px 14px;
    background-color: #0c67cf;
    color: white;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .styled-form button:hover {
    background-color: #01437c;
  }
</style>
    <!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->

    <!-- <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.11.3/datatables.min.css"/> -->
    <!-- <script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.11.3/datatables.min.js"></script> -->
    <script type="text/javascript">
      $(document).ready(function () {
        var table = $('#user-table').DataTable();
        var query = "";
        if (query) {
          $('#search-box').val(query);
          table.search(query).draw();
        }
        $('#search-box').on('keyup', function () {
          table.search(this.value).draw();
        });
      });
    </script>

    <link rel="stylesheet" href="{% static 'css/style_base.css' %}">
    <link rel="stylesheet" href="{% static 'css/css_icons.css' %}">
    <link rel="stylesheet" href="{% static 'css/css_colors.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'cdn/font-awesome.min.css' %}">
    <script src="{% static 'cdn/bootstrap.bundle.min.js' %}"></script>

    <script src="{% static 'cdn/jspdf.umd.min.js' %}"></script>
    <script src="{% static 'cdn/html2pdf.bundle.js' %}"></script>

    <script src="{% static 'cdn/jquery-3.5.1.slim.min.js' %}"></script>
    <script src="{% static 'cdn/jquery-3.6.0.min.js' %}"></script>
    <script src="{% static 'cdn/bootstrap.min.js' %}"></script>

    <!-- <script src="{% static 'cdn/popper.min.js' %}"></script> -->

    <link rel="stylesheet" type="text/css" href="{% static 'cdn/datatables.min.css' %}" />
    <script type="text/javascript" src="{% static 'cdn/datatables.min.js' %}"></script>

    <link rel="stylesheet" type="text/css"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css"
      href="https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/css/bootstrap-extended.min.css">
    <link rel="stylesheet" type="text/css"
      href="https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/fonts/simple-line-icons/style.min.css">
    <link rel="stylesheet" type="text/css"
      href="https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/css/colors.min.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">

    <!-- <link rel="stylesheet" href="{% static 'css/css_bootstrap.css' %}"> -->

    <link rel="stylesheet" href="{% static 'css/adminpanel.css' %}">


  </head>

  <body>
    <div class="page-wrap">


      <div class="main">

        <div class="side-bar">

          <p><strong>Access/Service Request Management</strong></p>
          <a href="{% url 'user_profile' %}" style="font-size: small;color: #1a8b10;">

            @{{request.user.EmployeeName}}
          </a>
          <hr class="new1">

          {% if analyst %}

          <a href="{% url 'master_view' %}">Master View</a>
          <a href="{% url 'form_submissions' %}">Manage Requests</a>
          <!-- <a href="{% url 'advanceSearch' %}">Advance Search</a> -->
          <a href="{% url 'user_list' %}">Manage Roles</a>
          <!-- <a href="{% url 'form_submissions' %}">Reports</a> -->
          <a href="{% url 'approver_list' %}">Approver</a>
          <!-- <a href="{% url 'addCategory' %}">Service Category</a> -->
          <!-- <a href="{% url 'oracle_db_test' %}">oracle_db_test</a> -->
          <a href="{% url 'execution_logs' %}">Execution_logs</a>
          <!-- <li class="shadow mb-2"><a href="{% url 'upload_signature' %}">Upload Signature</a></li> -->
          <!-- <li>Menu item 2
        <ul class="sub-menu">
          <li>Sub-menu item 2</li>
          <li>Sub-menu item 3</li>
        </ul>
      </li> -->
          <!-- <li>Menu item 3</li> -->
          {% endif %}

          <a href="{% url 'user_list' %}">Manage Roles</a>
          <a href="{% url 'upload_signature' %}">Upload Signature</a>

          <ul class="menu">
            {% if authorizer %}

            <li><a href="{% url 'access_request' %}">If authorizer is true</a></li>

            {% endif %}
          </ul>
          <!-- <a href="{% url 'logout' %}">Logout</a> -->

        </div>

        <div class="content-bar">
          <div class="row">
            <!-- Navbar Start -->
            <div>

              <div class="nav">
                <a href="{% url 'landing' %}">Home</a>
                <a href="{% url 'access_request' %}">Requests</a>
                <!-- <a href="{% url 'gini' %}">Tabs</a> -->




                <div class="logout" style="position:absolute; color: white;right: 20px;top: 5px; bottom: 5px;">
                  <a type="button" class="btn btn-outline-light btn-sm"
                    href="{% url 'logout' %}">Logout
                  </a>
                </div>
                <!-- <a style="" href="{% url 'logout' %}">Logout</a> -->

              </div>

            </div>
            <!-- Navbar End -->

            <!-- Alert Start -->

            {% if messages %}
            {% for message in messages %}
            <div class="col-md-12">
              <div
                style="border-radius: 0px;text-align: center ;margin: 0px;padding: 0px; background-color: #1a8b10; color: #ffffff;">
                <p id="alert">{{ message }}</p>

              </div>
            </div>
            {% endfor %}
            {% endif %}
            <!-- Alert End -->

            <!-- Content Start -->


            <div>
              {% block content %}

              {% endblock content %}
            </div>
            <!-- Content End -->


          </div>



        </div>

      </div>

    </div>
<div id="myModal" class="modal">
  <div class="modal-content-customized">
    <span id="closeModalBtn" class="close">&times;</span>
    <h4 style="font-family: 'Times New Roman', Times, serif; color: #ffffff; background-color: #f01847; border-top-left-radius: 10px; border-top-right-radius: 10px; padding: 5px; text-align: center;">Feedback/Remarks</h4>
      <form id="rejectionForm" class="styled-form">
        <label for="ror">Reason of Rejection</label>
        <input id="ror" name="ror" type="text" placeholder="Reason of Rejection">
        <button type="submit">Submit</button>
      </form>

    <!-- <p>This is a modal window.</p> -->
  </div>
</div>
    <footer> Copyright &copy; 2022
    </footer>
  </body>
<script>
  const modal = document.getElementById('myModal');
  const openBtn = document.getElementById('openModalBtn');
  const closeBtn = document.getElementById('closeModalBtn');

  openBtn.onclick = () => modal.style.display = 'block';
  closeBtn.onclick = () => modal.style.display = 'none';
  window.onclick = (e) => {
    if (e.target === modal) {
      modal.style.display = 'none';
    }
  };
</script>

<script>
  document.getElementById('rejectionForm').addEventListener('submit', function (e) {
    e.preventDefault();

    const ror = document.getElementById('ror').value;

    fetch('/submit-remarks', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': getCookie('csrftoken')
      },
      body: JSON.stringify({ ror: ror })
    })
    .then(response => response.json())
    .then(data => {
      window.location.reload();
      
      document.getElementById('message').innerText = data.message;
      document.getElementById('rejectionForm').reset();
      

    })
    .catch(error => console.error('Error:', error));
  });

  // CSRF token function
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        // Does this cookie string begin with the name we want?
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
</script>

</html>